<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Url Shorter</title>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous">
    </script>

    <style>
        body{
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-family: 'poppins' sans-serif;
        }
        main{
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            padding: 0;
            margin: 0;
            background-image: url('https://images.unsplash.com/photo-1447752875215-b2761acb3c5d');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            font-family: 'poppins' sans-serif;
        }
        .wrapper{
            border: 1px solid #dbdbdb;
            width: 50%;
            border-top-right-radius: 20px;
            border-top-left-radius: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); /* Adjust the values as needed */
            background: linear-gradient(to right, purple, red);
            transition: 0.3s all;
        }
        .title{
            /* border: 1px solid green; */
            padding-left: 20px;
            padding-top: 20px;
            padding-bottom: 20px;
        }

        .head{
            font-size: 20px;
            color: aliceblue;
        }
        a .small{
            color: aliceblue;
            text-decoration: none;
        }

        

        form input[type="text"] {
            width: 100%;
            height: 60px;
            padding-left: 10px;
            font-size: 20px;
            color: rgb(0, 0, 0);
        }

        form input[type="text"]::placeholder {
            font-size: 20px;
        }
        
        form input[type="submit"]{
            font-size: 20px;
            width: 100%;
            height: 50px;
            background-color: transparent;
            border: none;
            color: aliceblue;
            cursor: pointer;
            padding-top: 15px;
            transition: 0.3s all;
        }
        form input[type="submit"]:hover{
            background: linear-gradient(to right, purple, rgb(39, 17, 17));
            color: white;
        }

        .results{
            height: 150px;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .results h2{
            font-size: 38px;
        }
        .copy-code{
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        .copy-code div{
            height: 20px;
            width: 15px;
            background-color: black;
        }
        .copy-code small{
            font-size: 18px;
            cursor: pointer;
            transition: 0.3s all;
        }

        form .short{
            width: 100%;
            color: white;
            height: 50px;
        }

        
        
    </style>
</head>
<body>
    <main>
        <div class="wrapper">
        <div class="title">
        <p class="head">URL SHORTNER</p>
        <a href=""><p class="small">History</p></a>
        </div>
        <div>
            <form  id="post-form">
                {% csrf_token %}
                <input type="text" name="link" id="link" placeholder="Enter URL here">
                <div class="short">
                    <input type="submit" id="shortenButton" value="Shorten">
                </div>
            </form>
        </div>
        <div class="results">
            <h2 id="resultText"></h2>
            <div class="copy-code">
                <div></div>
                <small id="copyButton">Copy link</small>
            </div>
        </div>
        </div>
    </main>
<script>
            // Function to show/hide the copy button based on the content of resultText
function toggleCopyButton() {
    var copyButton = document.getElementById('copyButton');
    var resultText = document.getElementById('resultText');

    if (resultText.innerText.trim().length > 0) {
        copyButton.style.display = 'inline';
    } else {
        copyButton.style.display = 'none';
    }
}

// Execute this function after the DOM content is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    var copyButton = document.getElementById('copyButton');

    // Initially hide the copy button
    copyButton.style.display = 'none';

    // Event listener for the copy button
    copyButton.addEventListener('click', function() {
        var textToCopy = document.getElementById('resultText').innerText;
        copyToClipboard(textToCopy);

        // Change button text to "copied!"
        this.textContent = 'copied!';

        // Change button text back to "copy" after 3 seconds
        setTimeout(function() {
            copyButton.textContent = 'copy link';
        }, 3000); // 3000 milliseconds = 3 seconds
    });
});

// Function to copy text to clipboard
function copyToClipboard(text) {
    var dummyTextarea = document.createElement('textarea');
    document.body.appendChild(dummyTextarea);
    dummyTextarea.value = text;
    dummyTextarea.select();
    document.execCommand('copy');
    document.body.removeChild(dummyTextarea);
}



</script>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            var shortenButton = document.getElementById('shortenButton');

            shortenButton.addEventListener('click', function() {
                // Change button text to "Shortened!"
                this.value = 'Shortened!';

                // Set a timer to change button text back to "Shorten" after 3 seconds
                setTimeout(() => {
                    shortenButton.value = 'Shorten';
                }, 3000);
            });
        });
</script>

<script type="text/javascript">

            $(document).on('submit', '#post-form', function(e){
                e.preventDefault();

                $.ajax({
                    type: 'POST',
                    url : '/create',
                    data: {
                        link: $('#link').val(),
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    },
                    success: function(data) {
                        console.log(data.url); // Log the complete URL received from the server
                        $('h2').html(data.url); // Use the complete URL directly
                        
                        $('#resultText').text(data.url);

                        // Show/hide the copy button based on the content of resultText
                        toggleCopyButton();

                        // Clear the input field after successful submission
                        $('#link').val('');
                    }
                });
            });


</script>
</body>
</html>